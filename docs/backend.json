{
  "entities": {
    "Company": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Company",
      "type": "object",
      "description": "Represents a company being targeted in an outreach campaign.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Company entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the company."
        },
        "domain": {
          "type": "string",
          "description": "The company's website domain.",
          "format": "uri"
        },
        "industry": {
          "type": "string",
          "description": "The industry the company operates in."
        },
        "linkedinUrl": {
          "type": "string",
          "description": "The company's LinkedIn URL, if available.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "domain"
      ]
    },
    "Lead": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lead",
      "type": "object",
      "description": "Represents a lead (potential customer) being targeted in an outreach campaign.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lead entity."
        },
        "companyId": {
          "type": "string",
          "description": "Reference to Company. (Relationship: Company 1:N Lead)"
        },
        "firstName": {
          "type": "string",
          "description": "The lead's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The lead's last name."
        },
        "email": {
          "type": "string",
          "description": "The lead's email address.",
          "format": "email"
        },
        "linkedinProfileUrl": {
          "type": "string",
          "description": "The lead's LinkedIn profile URL, if available.",
          "format": "uri"
        },
        "jobTitle": {
          "type": "string",
          "description": "The lead's job title."
        },
        "status": {
          "type": "string",
          "description": "The current status of the lead in the outreach campaign (e.g., 'New', 'Contacted', 'Replied', 'Qualified', 'Closed')."
        }
      },
      "required": [
        "id",
        "companyId",
        "firstName",
        "lastName",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/companies/{companyId}",
        "definition": {
          "entityName": "Company",
          "schema": {
            "$ref": "#/backend/entities/Company"
          },
          "description": "Stores company data. Each company has a unique ID.",
          "params": [
            {
              "name": "companyId",
              "description": "The unique identifier of the company."
            }
          ]
        }
      },
      {
        "path": "/companies/{companyId}/leads/{leadId}",
        "definition": {
          "entityName": "Lead",
          "schema": {
            "$ref": "#/backend/entities/Lead"
          },
          "description": "Stores lead data associated with a specific company. Includes denormalized 'companyId' for authorization independence.",
          "params": [
            {
              "name": "companyId",
              "description": "The unique identifier of the company this lead is associated with."
            },
            {
              "name": "leadId",
              "description": "The unique identifier of the lead."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage company and lead data for the StealthFlow outreach engine. It follows a hierarchical structure to represent the relationship between companies and their associated leads. This structure facilitates efficient querying and data management, while also adhering to the principle of authorization independence by avoiding complex hierarchical dependencies in security rules. Specifically, the 'companyId' field is stored within each lead document, ensuring that access control for leads can be determined directly without needing to retrieve the parent company document.\n\n*   `/companies/{companyId}`: Stores company information.\n*   `/companies/{companyId}/leads/{leadId}`: Stores lead information associated with a specific company. The 'companyId' is denormalized into each lead document within the leads subcollection. This denormalization is crucial for authorization independence, as it allows security rules to validate lead access based on the presence of the 'companyId' without requiring a `get()` call to the parent company document.  This also directly supports QAPs, enabling secure list operations on leads based on the company they belong to.\n\nThe design facilitates straightforward security rules, with path-based access control for companies and the denormalized `companyId` enabling secure access control for leads. This structure directly addresses the authorization independence principle, avoiding hierarchical authorization dependencies. This also promotes scalability, as security checks are localized to each document, improving query performance."
  }
}